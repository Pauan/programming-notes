(USE {} = "nulan:Task")


(EXPORT { current-time = current_time }
  (FFI-IMPORT "FFI/Time"
    (current_time :: (Task Integer))))


(FUNCTION
  (benchmark :: (-> (Task Void) (Task Integer)))
  (benchmark task)
    (DO now = current-time
      (LET end = (add now 10000)
        (LOOP next
            | i = 0
          (DO now = current-time
            (IF (less? now end)
              (DO task
                  (next (add i 1)))
              (wrap i)))))))
